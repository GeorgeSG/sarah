input_boolean:
  routine_welcome_home:
    name: Coming home - Say welcome
    initial: on
    icon: mdi:account-plus-outline

script:
  routine_coming_home:
    alias: Routine - Coming home
    sequence:
      - service: script.security_camera_off
      - service: light.turn_on
        entity_id: light.living_room_all_lights
      - condition: state
        entity_id: input_boolean.routine_welcome_home
        state: "on"
      - delay: 00:00:03
      - service: script.coming_home_say_welcome

      # TODO: Add condition for time - don't blast music late at night :)
      - delay: 00:00:03
      - service: media_player.shuffle_set
        entity_id: media_player.master_bedroom
        data:
          shuffle: true
      - service: media_player.select_source
        entity_id: media_player.master_bedroom
        data:
          source: Evening Chill

  coming_home_say_welcome:
    alias: Routine - Coming home - Say welcome
    sequence:
      - service: media_player.volume_set
        entity_id: media_player.master_bedroom
        data:
          volume_level: 0.5
      - service: script.say
        data_template:
          partials:
            - !include ../../templates/partials/greeting.yaml
            - !include ../../templates/partials/time.yaml
            - "Here's the current status:"
            - !include ../../templates/partials/window_check.yaml
      - delay: 00:00:10
      - service: script.say
        data_template:
          message: >-

            {{
              [
                "I'll put some music on.",
                "I'll play some music.",
                "Here's some music."
              ] | random
            }}
