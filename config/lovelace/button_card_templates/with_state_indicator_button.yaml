with_state_indicator:
  variables:
    state_indicator_id: # defaults to entity_id
    state_indicator_size: 2px
    state_indicator_on_color: white
    state_indicator_off_color: transparent

    # Used when the button entity's state is 'on':
    state_on_indicator_on_color: white
    state_on_indicator_off_color: transparent
  triggers_update: all # unfortunately a template doesn't seem to work here :/
  double_tap_action:
    action: call-service
    service: homeassistant.toggle
    service_data:
      entity_id: "[[[ return variables.state_indicator_id || entity.entity_id ]]]"
  styles:
    name:
      - transform: "[[[ return 'translateY(' + variables.state_indicator_size + ')' ]]]"
    card:
      - border-bottom: >-
          [[[
            let color;
            const state_indicator = variables.state_indicator_id || entity.entity_id;

            if (entity.state === 'on') {
              color = states[state_indicator].state === 'on'
                  ? variables.state_on_indicator_on_color
                  : variables.state_on_indicator_off_color;
            } else {
              color = states[state_indicator].state === 'on'
                  ? variables.state_indicator_on_color
                  : variables.state_indicator_off_color;
            }

            return variables.state_indicator_size + ' solid ' + color;
          ]]]
