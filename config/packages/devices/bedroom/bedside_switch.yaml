sensor:
  - platform: mqtt
    name: "Bedside switch battery"
    state_topic: "z2m_deconz/bedside_switch"
    availability_topic: "z2m_deconz/bridge/state"
    unit_of_measurement: "%"
    device_class: "battery"
    value_template: "{{ value_json.battery }}"
  - platform: mqtt
    name: "Bedside switch LQI"
    state_topic: "z2m_deconz/bedside_switch"
    availability_topic: "z2m_deconz/bridge/state"
    unit_of_measurement: "lqi"
    device_class: "signal_strength"
    value_template: "{{ value_json.linkquality }}"

automation:
  - alias: Bedroom · Bedside Switch
    use_blueprint:
      path: aqara_switch.yaml
      input:
        z2m_topic: "z2m_deconz/bedside_switch"
        click:
          - service: light.toggle
            data_template:
              entity_id: >-
                {% if is_state('input_select.bedroom_mode', 'day') %}
                  light.master_bedroom_main
                {% else %}
                  light.bedside
                {% endif %}
              brightness_pct: 100

          # - service: script.bed_led_toggle
          #   data_template:
          #     brightness_pct: "{{ is_state('input_select.bedroom_mode', 'night') | iif(40, 100)}}"

        double_click:
          - service: light.toggle
            entity_id: light.bedside
            data:
              brightness_pct: 100
          # - service: script.bed_led_toggle
          #   data_template:
          #     brightness_pct: "{{ is_state('input_select.bedroom_mode', 'night') | iif(40, 100)}}"

        hold:
          - service: script.toggle_bedroom_mode
