# https://www.home-assistant.io/integrations/script

sarah_restart:
  alias: Restart SARAH
  sequence:
    service: homeassistant.restart

security_camera_on:
  alias: Turn security camera on
  sequence:
    - service: camera.turn_on
      entity_id: camera.amcrest_camera
    - service: amcrest.goto_preset
      entity_id: camera.amcrest_camera
      data:
        preset: 1
    - service: amcrest.enable_motion_recording
      entity_id: camera.amcrest_camera
    - service: amcrest.enable_recording
      entity_id: camera.amcrest_camera
    - service: amcrest.enable_audio
      entity_id: camera.amcrest_camera

security_camera_off:
  alias: Turn security camera off
  sequence:
    - service: amcrest.goto_preset
      entity_id: camera.amcrest_camera
      data:
        preset: 3
    - service: amcrest.disable_motion_recording
      entity_id: camera.amcrest_camera
    - service: amcrest.disable_recording
      entity_id: camera.amcrest_camera
    - service: amcrest.disable_audio
      entity_id: camera.amcrest_camera
    - service: camera.turn_off
      entity_id: camera.amcrest_camera

# tv_chill:
#   alias: TV Chill
#   sequence:
#     - service: media_extractor.play_media
#       data:
#         entity_id: media_player.living_room_tv_2
#         media_content_id: "https://www.youtube.com/watch?v=UgHKb_7884o"
#         media_content_type: video/youtube

# latest_pds:
#   alias: Play the latest PDS
#   sequence:
#     - service: media_extractor.play_media
#       data_template:
#         entity_id: media_player.living_room_tv_2
#         media_content_id: "{{ state_attr('sensor.philip_defranco', 'url') }}"
#         media_content_type: video/youtube

say_discretely:
  alias: Say discretely
  sequence:
    - service_template: >
        {% if is_state('media_player.master_bedroom', 'playing')
              or is_state('input_boolean.guest_mode', 'on')
              or is_state('input_boolean.speech_notifications', 'off') %}
          script.telegram_say
        {% else %}
          script.sonos_blast
        {% endif %}
      data_template:
        message: "{{ message }}"

sonos_blast:
  alias: Sonos blast
  sequence:
    - service: tts.amazon_polly_say
      data_template:
        entity_id: media_player.master_bedroom
        message: "{{ message }}"

sonos_say:
  alias: Sonos say
  sequence:
    - service: sonos.snapshot
      data_template:
        with_group: yes
        entity_id: media_player.master_bedroom
    - delay: "00:00:02"
    - service: script.sonos_blast
      data_template:
        message: "{{ message }}"
    - delay: "00:00:05"
    - service: sonos.restore
      data_template:
        with_group: yes
        entity_id: media_player.master_bedroom

telegram_say:
  alias: Telegram say
  sequence:
    - service: notify.telegram
      data_template:
        message: "{{ message }}"

sarah_talk:
  alias: SARAH - Talk
  sequence:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.sleep_mode
          state: "off"
        - condition: time
          after: "08:00:00"
          before: "23:59:00"
        - condition: state
          entity_id: input_boolean.speech_notifications
          state: "on"
    - service: script.say_discretely
      data_template:
        message: "{{ message }}"

sarah_briefing:
  alias: Briefing
  sequence:
    - service: script.sarah_talk
      data_template:
        message: !include ./templates/briefing.yaml
